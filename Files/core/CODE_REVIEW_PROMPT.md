# BinaryEcom 项目全面代码审查提示词

## 📋 提示词使用说明

本提示词用于对 BinaryEcom 电商/直销系统进行全面细致的代码审查。请按照以下结构进行审查，确保覆盖所有关键方面。

---

## 🎯 审查目标

对 BinaryEcom 项目进行全面代码审查，评估代码质量、性能、安全性、可维护性等方面，并提供详细的改进建议。

---

## 📊 项目基本信息

**项目名称**: BinaryEcom 电商/直销系统  
**技术栈**: Laravel 11 + PHP 8.3  
**项目类型**: 电商/直销系统（MLM）  
**核心功能**: 
- PV（业绩值）台账管理
- 周结算和季度分红
- 退款和订单调整
- 奖金计算（对碰奖、管理奖等）
- 权限管理系统

---

## 🔍 审查维度

### 1. 架构设计审查

#### 1.1 整体架构
- [ ] **MVC 架构**: 是否遵循标准的 MVC 模式？
- [ ] **分层设计**: 控制器、服务层、数据访问层是否清晰分离？
- [ ] **目录结构**: 目录组织是否合理、清晰？
- [ ] **依赖注入**: 是否正确使用依赖注入？
- [ ] **服务提供者**: Service Provider 是否合理使用？

#### 1.2 设计模式
- [ ] **Repository 模式**: 数据访问是否使用 Repository 模式？
- [ ] **策略模式**: 复杂业务逻辑是否使用策略模式？
- [ ] **工厂模式**: 对象创建是否使用工厂模式？
- [ ] **观察者模式**: 事件处理是否使用观察者模式？
- [ ] **单例模式**: 是否有不恰当的单例使用？

#### 1.3 SOLID 原则
- [ ] **单一职责**: 每个类/方法是否只负责一件事？
- [ ] **开闭原则**: 代码是否对扩展开放、对修改关闭？
- [ ] **里氏替换**: 继承关系是否合理？
- [ ] **接口隔离**: 接口是否设计合理？
- [ ] **依赖倒置**: 是否依赖抽象而非具体实现？

---

### 2. 代码质量审查

#### 2.1 代码规范
- [ ] **PSR-12**: 是否遵循 PSR-12 编码标准？
- [ ] **命名规范**: 变量、方法、类命名是否清晰、有意义？
- [ ] **注释**: PHPDoc 注释是否完整、准确？
- [ ] **代码格式**: 代码格式是否一致？
- [ ] **类型声明**: 是否使用 PHP 8.3 的类型声明？

#### 2.2 方法复杂度
- [ ] **方法长度**: 单个方法是否超过 50 行？
- [ ] **圈复杂度**: 圈复杂度是否超过 10？
- [ ] **嵌套层级**: 嵌套层级是否超过 3 层？
- [ ] **参数数量**: 方法参数是否超过 5 个？
- [ ] **返回值**: 是否有明确的返回值类型？

#### 2.3 代码复用
- [ ] **重复代码**: 是否存在大量重复代码？
- [ ] **提取方法**: 是否将重复逻辑提取为方法？
- [ ] **Trait 使用**: 是否合理使用 Trait 复用代码？
- [ ] **Helper 函数**: 是否合理使用辅助函数？

#### 2.4 错误处理
- [ ] **异常处理**: 是否有完善的异常处理机制？
- [ ] **错误日志**: 是否记录详细的错误日志？
- [ ] **用户友好**: 错误信息是否对用户友好？
- [ ] **日志级别**: 日志级别是否合理使用？

---

### 3. 业务逻辑审查

#### 3.1 核心服务
- [ ] **AdjustmentService**: 退款调整逻辑是否正确？
- [ ] **PVLedgerService**: PV 台账管理是否准确？
- [ ] **SettlementService**: 结算逻辑是否完整？
- [ ] **事务处理**: 是否正确使用数据库事务？
- [ ] **幂等性**: 关键操作是否保证幂等性？

#### 3.2 数据一致性
- [ ] **事务边界**: 事务边界是否合理？
- [ ] **并发控制**: 是否有并发控制机制？
- [ ] **数据验证**: 输入数据是否充分验证？
- [ ] **外键约束**: 是否使用外键约束？
- [ ] **级联操作**: 级联删除/更新是否正确？

#### 3.3 业务规则
- [ ] **奖金计算**: 奖金计算公式是否正确？
- [ ] **PV 计算**: PV 累加和结转是否准确？
- [ ] **对碰逻辑**: 对碰奖计算是否正确？
- [ ] **管理奖**: 管理奖计算是否符合规则？
- [ ] **结转逻辑**: PV 结转逻辑是否正确？

---

### 4. 数据库设计审查

#### 4.1 表结构设计
- [ ] **字段类型**: 字段类型是否合理？
- [ ] **字段长度**: 字段长度是否足够？
- [ ] **默认值**: 默认值是否合理？
- [ ] **NOT NULL**: 是否合理使用 NOT NULL 约束？
- [ ] **索引**: 是否为查询字段添加索引？

#### 4.2 索引优化
- [ ] **主键索引**: 所有表是否有主键？
- [ ] **唯一索引**: 唯一约束是否使用唯一索引？
- [ ] **复合索引**: 是否使用复合索引优化查询？
- [ ] **索引覆盖**: 索引是否覆盖常用查询？
- [ ] **索引冗余**: 是否存在冗余索引？

#### 4.3 查询性能
- [ ] **N+1 问题**: 是否存在 N+1 查询问题？
- [ ] **慢查询**: 是否存在慢查询？
- [ ] **全表扫描**: 是否存在全表扫描？
- [ ] **子查询**: 是否有不必要的子查询？
- [ ] **JOIN 优化**: JOIN 查询是否优化？

#### 4.4 迁移文件
- [ ] **回滚支持**: 迁移是否支持回滚？
- [ ] **数据安全**: 迁移是否保护现有数据？
- [ ] **条件检查**: 是否有表/字段存在性检查？
- [ ] **索引创建**: 索引创建是否在迁移中？

---

### 5. 性能审查

#### 5.1 查询性能
- [ ] **预加载**: 是否使用 Eloquent 预加载？
- [ ] **批量操作**: 是否使用批量插入/更新？
- [ ] **分块处理**: 大数据量是否使用分块处理？
- [ ] **查询构建器**: 是否合理使用查询构建器？
- [ ] **原生 SQL**: 是否有不必要的原生 SQL？

#### 5.2 缓存策略
- [ ] **Redis 缓存**: 是否使用 Redis 缓存热点数据？
- [ ] **缓存失效**: 缓存失效机制是否合理？
- [ ] **缓存预热**: 是否有缓存预热机制？
- [ ] **缓存穿透**: 是否防止缓存穿透？
- [ ] **缓存雪崩**: 是否防止缓存雪崩？

#### 5.3 内存使用
- [ ] **内存泄漏**: 是否存在内存泄漏？
- [ ] **大对象**: 是否有不必要的大对象加载？
- [ ] **资源释放**: 资源是否正确释放？
- [ ] **循环引用**: 是否存在循环引用？

#### 5.4 并发性能
- [ ] **锁机制**: 是否使用分布式锁？
- [ ] **队列处理**: 耗时操作是否使用队列？
- [ ] **异步处理**: 是否使用异步处理？
- [ ] **连接池**: 是否使用数据库连接池？

---

### 6. 安全性审查

#### 6.1 输入验证
- [ ] **表单验证**: 所有输入是否验证？
- [ ] **XSS 防护**: 是否防止 XSS 攻击？
- [ ] **SQL 注入**: 是否防止 SQL 注入？
- [ ] **CSRF 保护**: 是否启用 CSRF 保护？
- [ ] **文件上传**: 文件上传是否安全？

#### 6.2 权限控制
- [ ] **认证机制**: 认证机制是否完善？
- [ ] **授权检查**: 是否有授权检查？
- [ ] **角色管理**: 角色权限是否清晰？
- [ ] **API 安全**: API 是否有安全措施？
- [ ] **敏感操作**: 敏感操作是否有额外验证？

#### 6.3 数据保护
- [ ] **敏感数据**: 敏感数据是否加密？
- [ ] **密码存储**: 密码是否使用哈希存储？
- [ ] **日志脱敏**: 日志是否脱敏处理？
- [ ] **数据传输**: 数据传输是否加密？
- [ ] **备份安全**: 备份数据是否安全？

#### 6.4 配置安全
- [ ] **环境变量**: 敏感配置是否使用环境变量？
- [ ] **调试模式**: 生产环境是否关闭调试？
- [ ] **错误显示**: 错误信息是否暴露敏感信息？
- [ ] **文件权限**: 文件权限是否正确设置？

---

### 7. 测试覆盖审查

#### 7.1 单元测试
- [ ] **服务层测试**: 核心服务是否有单元测试？
- [ ] **模型测试**: 模型是否有测试？
- [ ] **辅助函数**: 辅助函数是否有测试？
- [ ] **测试覆盖率**: 测试覆盖率是否达到 70%+？
- [ ] **边界测试**: 是否有边界条件测试？

#### 7.2 集成测试
- [ ] **API 测试**: API 是否有集成测试？
- [ ] **数据库测试**: 数据库操作是否有测试？
- [ ] **缓存测试**: 缓存逻辑是否有测试？
- [ ] **队列测试**: 队列任务是否有测试？

#### 7.3 功能测试
- [ ] **用户流程**: 关键用户流程是否有测试？
- [ ] **业务场景**: 业务场景是否有测试？
- [ ] **异常场景**: 异常场景是否有测试？

#### 7.4 性能测试
- [ ] **负载测试**: 是否有负载测试？
- [ ] **压力测试**: 是否有压力测试？
- [ ] **基准测试**: 是否有性能基准测试？

---

### 8. 文档审查

#### 8.1 代码注释
- [ ] **PHPDoc**: 类和方法是否有 PHPDoc 注释？
- [ ] **参数说明**: 参数是否有说明？
- [ ] **返回值**: 返回值是否有说明？
- [ ] **异常说明**: 抛出的异常是否有说明？
- [ ] **示例代码**: 复杂逻辑是否有示例代码？

#### 8.2 技术文档
- [ ] **架构文档**: 是否有系统架构文档？
- [ ] **API 文档**: 是否有 API 文档？
- [ ] **数据库文档**: 是否有数据库设计文档？
- [ ] **部署文档**: 是否有部署文档？
- [ ] **故障排查**: 是否有故障排查指南？

#### 8.3 业务文档
- [ ] **业务流程**: 是否有业务流程说明？
- [ ] **奖金规则**: 是否有奖金计算规则文档？
- [ ] **PV 规则**: 是否有 PV 计算规则文档？
- [ ] **结算规则**: 是否有结算规则文档？

---

### 9. 依赖管理审查

#### 9.1 Composer 依赖
- [ ] **版本管理**: 依赖版本是否明确？
- [ ] **安全更新**: 依赖是否有安全漏洞？
- [ ] **过期依赖**: 是否有过期的依赖？
- [ ] **冗余依赖**: 是否有未使用的依赖？
- [ ] **许可证**: 依赖许可证是否兼容？

#### 9.2 NPM 依赖
- [ ] **版本管理**: 前端依赖版本是否明确？
- [ ] **安全更新**: 前端依赖是否有安全漏洞？
- [ ] **构建工具**: 构建工具是否合理？

---

### 10. 配置管理审查

#### 10.1 环境配置
- [ ] **环境变量**: 敏感配置是否使用环境变量？
- [ ] **配置文件**: 配置文件是否合理组织？
- [ ] **配置缓存**: 是否使用配置缓存？
- [ ] **配置验证**: 配置是否有验证？

#### 10.2 应用配置
- [ ] **时区设置**: 时区是否正确设置？
- [ ] **语言设置**: 语言配置是否合理？
- [ ] **缓存配置**: 缓存配置是否合理？
- [ ] **队列配置**: 队列配置是否合理？

---

### 11. 路由设计审查

#### 11.1 路由组织
- [ ] **路由分组**: 路由是否合理分组？
- [ ] **命名路由**: 是否使用命名路由？
- [ ] **RESTful**: 是否遵循 RESTful 设计？
- [ ] **中间件**: 中间件是否正确使用？
- [ ] **路由缓存**: 是否使用路由缓存？

#### 11.2 API 设计
- [ ] **版本控制**: API 是否有版本控制？
- [ ] **统一响应**: 响应格式是否统一？
- [ ] **错误码**: 错误码是否规范？
- [ ] **限流**: API 是否有速率限制？

---

### 12. 日志和监控审查

#### 12.1 日志记录
- [ ] **日志级别**: 日志级别是否合理使用？
- [ ] **日志内容**: 日志内容是否详细？
- [ ] **日志格式**: 日志格式是否统一？
- [ ] **日志轮转**: 是否有日志轮转机制？
- [ ] **敏感信息**: 日志是否包含敏感信息？

#### 12.2 监控告警
- [ ] **性能监控**: 是否有性能监控？
- [ ] **错误监控**: 是否有错误监控？
- [ ] **业务监控**: 是否有业务指标监控？
- [ ] **告警机制**: 是否有告警机制？

---

## 📝 审查输出格式

### 1. 总体评估
```
总体评分: ⭐⭐⭐⭐☆ (4/5)
项目类型: Laravel 11 电商/直销系统
PHP 版本: ^8.3
```

### 2. 分项评分
| 维度 | 评分 | 说明 |
|------|------|------|
| 架构设计 | ⭐⭐⭐⭐☆ | 4/5 - 清晰的分层架构 |
| 代码质量 | ⭐⭐⭐⭐☆ | 4/5 - 遵循标准，可读性好 |
| 业务逻辑 | ⭐⭐⭐⭐⭐ | 5/5 - 复杂逻辑实现完整 |
| 性能优化 | ⭐⭐⭐☆☆ | 3/5 - 存在性能瓶颈 |
| 安全性 | ⭐⭐⭐☆☆ | 3/5 - 需要加强 |
| 测试覆盖 | ⭐⭐☆☆☆ | 2/5 - 缺少测试 |
| 文档质量 | ⭐⭐⭐⭐☆ | 4/5 - 注释完整 |

### 3. 问题清单
#### 3.1 严重问题 (P0)
- [ ] 问题描述
  - **位置**: 文件路径:行号
  - **影响**: 问题描述
  - **建议**: 改进建议
  - **示例代码**: 
    ```php
    // 问题代码
    // 建议代码
    ```

#### 3.2 高优先级问题 (P1)
- [ ] 问题描述
  - **位置**: 文件路径:行号
  - **影响**: 问题描述
  - **建议**: 改进建议

#### 3.3 中优先级问题 (P2)
- [ ] 问题描述
  - **位置**: 文件路径:行号
  - **影响**: 问题描述
  - **建议**: 改进建议

### 4. 优点总结
- ✅ 优点1
- ✅ 优点2
- ✅ 优点3

### 5. 改进建议
#### 5.1 短期改进（1-2周）
1. 改进项1
2. 改进项2
3. 改进项3

#### 5.2 中期改进（3-4周）
1. 改进项1
2. 改进项2
3. 改进项3

#### 5.3 长期改进（5-8周）
1. 改进项1
2. 改进项2
3. 改进项3

### 6. 推荐工具
- **PHPStan**: 静态分析
- **PHP CS Fixer**: 代码格式化
- **PHPMD**: 代码质量检测
- **PHPUnit**: 单元测试
- **Laravel Telescope**: 调试工具

---

## 🎯 审查重点

### 核心服务文件
1. `app/Services/AdjustmentService.php` - 退款调整服务
2. `app/Services/PVLedgerService.php` - PV 台账服务
3. `app/Services/SettlementService.php` - 结算服务

### 数据库相关
1. `database/migrations/` - 所有迁移文件
2. `app/Models/` - 所有模型文件

### 控制器
1. `app/Http/Controllers/` - 所有控制器
2. `app/Http/Requests/` - 表单验证
3. `app/Http/Middleware/` - 中间件

### 测试
1. `tests/Unit/` - 单元测试
2. `tests/Feature/` - 功能测试
3. `tests/Performance/` - 性能测试

---

## 📊 评分标准

### 优秀 (5/5) ⭐⭐⭐⭐⭐
- 完全符合最佳实践
- 代码质量极高
- 无明显问题
- 文档完善

### 良好 (4/5) ⭐⭐⭐⭐☆
- 符合大部分最佳实践
- 代码质量高
- 有少量小问题
- 文档较完善

### 中等 (3/5) ⭐⭐⭐☆☆
- 符合基本规范
- 代码质量一般
- 有一些问题需要改进
- 文档基本完整

### 较差 (2/5) ⭐⭐☆☆☆
- 不完全符合规范
- 代码质量较低
- 有较多问题
- 文档不完整

### 很差 (1/5) ⭐☆☆☆☆
- 不符合规范
- 代码质量差
- 有严重问题
- 缺少文档

---

## 🔧 审查方法

### 1. 静态代码分析
- 使用 PHPStan 进行静态分析
- 使用 PHPMD 检测代码质量
- 使用 PHP CS Fixer 检查代码规范

### 2. 手动代码审查
- 逐文件阅读代码
- 检查业务逻辑
- 评估代码质量

### 3. 架构设计评估
- 分析系统架构
- 评估设计模式使用
- 检查 SOLID 原则

### 4. 安全性检查
- 检查输入验证
- 检查权限控制
- 检查数据保护

### 5. 性能分析
- 检查查询性能
- 检查缓存使用
- 检查并发处理

---

## 📚 参考资源

- [Laravel 最佳实践](https://github.com/alexeymezenin/laravel-best-practices)
- [PSR-12 编码标准](https://www.php-fig.org/psr/psr-12/)
- [Laravel 文档](https://laravel.com/docs/11.x)
- [PHP 8.3 新特性](https://www.php.net/releases/8.3)
- [SOLID 原则](https://en.wikipedia.org/wiki/SOLID)

---

## 🎯 使用建议

### 1. 审查前准备
- 阅读项目文档
- 了解业务逻辑
- 熟悉技术栈

### 2. 审查过程
- 按照维度逐项审查
- 记录所有发现的问题
- 提供具体的改进建议

### 3. 审查后整理
- 生成审查报告
- 按优先级排序问题
- 提供改进计划

---

**提示词版本**: 1.0  
**创建日期**: 2025-12-24  
**适用项目**: BinaryEcom 电商/直销系统  
**技术栈**: Laravel 11 + PHP 8.3